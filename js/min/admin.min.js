const ADMIN_PORTAL={vehicles:[],vehicleMap:new Map,activeId:null,isDirty:!1,isHydrating:!1},boolFromValue=e=>e===1||e==="1"||e===!0,toInt=e=>{const t=parseInt(e,10);return Number.isNaN(t)?0:t},toFloat=e=>{const t=parseFloat(e);return Number.isNaN(t)?0:t},buildSearchKey=e=>{const t=e.name||"",n=e.type||"",s=e.slug||"";return`${t} ${n} ${s}`.toLowerCase().trim()};$(function(){const f=document.getElementById("vehicle-data");if(!f)return;try{ADMIN_PORTAL.vehicles=JSON.parse(f.textContent)||[]}catch{ADMIN_PORTAL.vehicles=[]}ADMIN_PORTAL.vehicleMap=new Map(ADMIN_PORTAL.vehicles.map(e=>[String(e.id),e]));const t=document.getElementById("vehicle-form"),v=document.querySelector(".editor-empty"),r=document.getElementById("vehicle-status"),o=document.querySelector(".admin-save"),m=document.querySelector(".admin-reset"),i=Array.from(document.querySelectorAll(".vehicle-item")),h=document.getElementById("vehicle-search"),u=document.querySelector(".vehicle-empty");if(!t||!o||!m||!r)return;const e={id:t.querySelector('[name="id"]'),name:t.querySelector('[name="name"]'),type:t.querySelector('[name="type"]'),slug:t.querySelector('[name="slug"]'),base_price_USD:t.querySelector('[name="base_price_USD"]'),insurance:t.querySelector('[name="insurance"]'),people:t.querySelector('[name="people"]'),bags:t.querySelector('[name="bags"]'),doors:t.querySelector('[name="doors"]'),manual:t.querySelector('[name="manual"]'),ac:t.querySelector('[name="ac"]'),fourwd:t.querySelector('[name="4wd"]'),showing:t.querySelector('[name="showing"]'),landing_order:t.querySelector('[name="landing_order"]')},n={img:document.querySelector(".preview-image img"),title:document.querySelector(".preview-title"),subtitle:document.querySelector(".preview-subtitle"),price:document.querySelector(".preview-price"),showing:document.querySelector(".showing-preview"),landing:document.querySelector(".landing-preview")},s=(e,t="")=>{r.textContent=e||"",r.classList.remove("success","error","info"),t&&r.classList.add(t)},l=e=>{ADMIN_PORTAL.isDirty=e,o.disabled=!e,t.classList.toggle("is-dirty",e)},c=(e,t,n)=>{if(!e)return;e.textContent=n,e.classList.toggle("tag-on",t),e.classList.toggle("tag-off",!t)},a=e=>{if(!e)return;const t=e.name||"Vehicle",i=e.type||"Type",a=e.base_price_USD??0,s=e.slug||"",r=s?`/assets/images/vehicles/${s}.avif`:"/assets/images/logo.avif";n.title&&(n.title.textContent=t),n.subtitle&&(n.subtitle.textContent=i),n.price&&(n.price.textContent=`USD$${a}/day`),n.img&&(n.img.src=r,n.img.alt=`${t} image`);const l=boolFromValue(e.showing),o=e.landing_order!==null&&e.landing_order!==""&&e.landing_order!==0[0],d=o?`Landing #${e.landing_order}`:"Landing Hidden";c(n.showing,l,"Showing"),c(n.landing,o,d)},d=t=>{ADMIN_PORTAL.isHydrating=!0,e.id.value=t.id??"",e.name.value=t.name??"",e.type.value=t.type??"",e.slug.value=t.slug??"",e.base_price_USD.value=t.base_price_USD??"",e.insurance.value=t.insurance??"",e.people.value=t.people??"",e.bags.value=t.bags??"",e.doors.value=t.doors??"",e.manual.checked=boolFromValue(t.manual),e.ac.checked=boolFromValue(t.ac),e.fourwd.checked=boolFromValue(t["4wd"]),e.showing.checked=boolFromValue(t.showing),e.landing_order.value=t.landing_order??"",ADMIN_PORTAL.isHydrating=!1},p=()=>{const t=e.landing_order.value.trim();return{id:e.id.value?parseInt(e.id.value,10):null,name:e.name.value.trim(),type:e.type.value.trim(),slug:e.slug.value.trim(),base_price_USD:toFloat(e.base_price_USD.value),insurance:toFloat(e.insurance.value),people:toInt(e.people.value),bags:toInt(e.bags.value),doors:toInt(e.doors.value),manual:e.manual.checked?1:0,ac:e.ac.checked?1:0,"4wd":e.fourwd.checked?1:0,showing:e.showing.checked?1:0,landing_order:t===""?null:toInt(t)}},b=e=>{const t=document.querySelector(`.vehicle-item[data-vehicle-id="${e.id}"]`);if(!t)return;const n=t.querySelector(".vehicle-name"),s=t.querySelector(".vehicle-type"),o=t.querySelector(".vehicle-price"),i=t.querySelector(".vehicle-seats"),a=t.querySelector(".vehicle-transmission"),l=t.querySelector(".showing-tag"),d=t.querySelector(".landing-tag");n&&(n.textContent=e.name||"Vehicle"),s&&(s.textContent=e.type||""),o&&(o.textContent=`USD$${e.base_price_USD??0}/day`),i&&(i.textContent=`${e.people??0} seats`),a&&(a.textContent=boolFromValue(e.manual)?"Manual":"Automatic");const u=boolFromValue(e.showing),r=e.landing_order!==null&&e.landing_order!==""&&e.landing_order!==0[0],h=r?`Landing #${e.landing_order}`:"Landing Hidden";c(l,u,"Showing"),c(d,r,h),t.dataset.search=buildSearchKey(e)},g=e=>{const n=ADMIN_PORTAL.vehicleMap.get(String(e));if(!n)return;ADMIN_PORTAL.activeId=String(e),i.forEach(t=>t.classList.toggle("active",t.dataset.vehicleId===String(e))),v.hidden=!0,t.hidden=!1,d(n),a(n),l(!1),s("")},j=e=>{let t=0;const n=e.toLowerCase();i.forEach(e=>{const o=(e.dataset.search||"").toLowerCase(),s=o.includes(n);e.hidden=!s,s&&t++}),u&&(u.hidden=n.length===0||t>0)},y=async()=>{if(!ADMIN_PORTAL.activeId)return;const e=p();s("Saving...","info"),o.disabled=!0;try{const n=await fetch("/includes/admin-vehicles.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update_vehicle",vehicle:e})}),t=await n.json();if(!n.ok||!t.success){s(t.message||"Save failed.","error"),o.disabled=!1;return}ADMIN_PORTAL.vehicleMap.set(String(t.vehicle.id),t.vehicle),b(t.vehicle),d(t.vehicle),a(t.vehicle),l(!1),s("Saved","success")}catch{s("Network error.","error"),o.disabled=!1}},_=()=>{if(!ADMIN_PORTAL.activeId)return;const e=ADMIN_PORTAL.vehicleMap.get(String(ADMIN_PORTAL.activeId));if(!e)return;d(e),a(e),l(!1),s("Changes reset.","info")};i.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.vehicleId;if(String(t)===String(ADMIN_PORTAL.activeId))return;if(ADMIN_PORTAL.isDirty&&!window.confirm("Discard unsaved changes?"))return;g(t)})}),t.addEventListener("submit",e=>{e.preventDefault()}),t.addEventListener("input",()=>{if(ADMIN_PORTAL.isHydrating)return;l(!0),s("Unsaved changes","info"),a(p())}),o.addEventListener("click",y),m.addEventListener("click",_),h&&h.addEventListener("input",e=>{j(e.target.value.trim())}),i.length>0&&g(i[0].dataset.vehicleId)})